DROP TABLE "SALES_INFO";
DROP TABLE "CUSTOMER_INFO";

CREATE TABLE "CUSTOMER_INFO" (
	"CUSTNO"	NUMBER(6)		NOT NULL,
	"CUSTNAME"	VARCHAR2(20)		NULL,
	"PHONE"	VARCHAR2(13)		NULL,
	"ADDRESS"	VARCHAR2(60)		NULL,
	"JOINDATE"	DATE		NULL,
	"GRADE"	CHAR(1)		NULL,
	"CITY"	CHAR(2)		NULL
);

COMMENT ON COLUMN "CUSTOMER_INFO"."CUSTNO" IS '회원번호';

COMMENT ON COLUMN "CUSTOMER_INFO"."CUSTNAME" IS '회원성명';

COMMENT ON COLUMN "CUSTOMER_INFO"."PHONE" IS '연락처';

COMMENT ON COLUMN "CUSTOMER_INFO"."ADDRESS" IS '주소';

COMMENT ON COLUMN "CUSTOMER_INFO"."JOINDATE" IS '가입일자';

COMMENT ON COLUMN "CUSTOMER_INFO"."GRADE" IS '고객코드';

COMMENT ON COLUMN "CUSTOMER_INFO"."CITY" IS '도시코드';


CREATE TABLE "SALES_INFO" (
	"CUSTNO"	NUMBER(6)		NOT NULL,
    "SALENOL"	NUMBER(8)		NOT NULL,
	"PCOST"	NUMBER(8)		NULL,
	"AMOUNT"	NUMBER(4)		NULL,
	"PRICE"	NUMBER(8)		NULL,
	"PCODE"	VARCHAR2(4)		NULL,
	"SDATE"	DATE		NULL
);

COMMENT ON COLUMN "SALES_INFO"."CUSTNO" IS '회원번호';

COMMENT ON COLUMN "SALES_INFO"."SALENOL" IS '판매번호';

COMMENT ON COLUMN "SALES_INFO"."PCOST" IS '단가';

COMMENT ON COLUMN "SALES_INFO"."AMOUNT" IS '수량';

COMMENT ON COLUMN "SALES_INFO"."PRICE" IS '가격';

COMMENT ON COLUMN "SALES_INFO"."PCODE" IS '상품코드';

COMMENT ON COLUMN "SALES_INFO"."SDATE" IS '판매일자';

ALTER TABLE "CUSTOMER_INFO" ADD CONSTRAINT "PK_CUSTOMER_INFO" PRIMARY KEY (
	"CUSTNO"
);

ALTER TABLE "SALES_INFO" ADD CONSTRAINT "FK_CUSTOMER_INFO_TO_SALES_INFO_1" FOREIGN KEY (
	"CUSTNO"
)
REFERENCES "CUSTOMER_INFO" (
	"CUSTNO"
);

ALTER TABLE "SALES_INFO" ADD CONSTRAINT "PK_SALES_INFO" PRIMARY KEY (
	"SALENOL",
	"CUSTNO"
);

create sequence seq_no start with 100001;
delete from CUSTOMER_INFO;
drop sequence seq_no;


INSERT INTO CUSTOMER_INFO ( CUSTNO, CUSTNAME, PHONE, ADDRESS, JOINDATE, GRADE, CITY) VALUES(seq_no.nextval, '김행복','010-1111-2222', '서울 동대문구 휘경1동', '20151202', 'A', '01');
INSERT INTO CUSTOMER_INFO ( CUSTNO, CUSTNAME, PHONE, ADDRESS, JOINDATE, GRADE, CITY) VALUES(seq_no.nextval, '이춘복', '010-1111-3333', '서울 동대문구 휘경2동', '20151206', 'B', '01');
INSERT INTO CUSTOMER_INFO ( CUSTNO, CUSTNAME, PHONE, ADDRESS, JOINDATE, GRADE, CITY) VALUES(seq_no.nextval, '장믿음', '010-1111-4444', '울릉군 울릉읍 독도1리', '20151001', 'B', '30');
INSERT INTO CUSTOMER_INFO ( CUSTNO, CUSTNAME, PHONE, ADDRESS, JOINDATE, GRADE, CITY) VALUES(seq_no.nextval, '최사랑', '010-1111-5555', '울릉군 울릉읍 독도2리', '20151113', 'A', '30');
INSERT INTO CUSTOMER_INFO ( CUSTNO, CUSTNAME, PHONE, ADDRESS, JOINDATE, GRADE, CITY) VALUES(seq_no.nextval, '진평화', '010-1111-6666', '제주도 제주시 외나무골', '20151225', 'B', '60');
INSERT INTO CUSTOMER_INFO ( CUSTNO, CUSTNAME, PHONE, ADDRESS, JOINDATE, GRADE, CITY) VALUES(seq_no.nextval, '차공단', '010-1111-7777', '제주도 제주시 감나무골', '20151211', 'C', '60');

SELECT * FROM CUSTOMER_INFO;



INSERT INTO SALES_INFO  VALUES ('100001','20160001','500','5','2500','A001','20160101');
INSERT INTO SALES_INFO  VALUES ('100001','20160002','1000','4','4000','A002','20160101');
INSERT INTO SALES_INFO  VALUES ('100001','20160003','500','3','1500','A008','20160101');
INSERT INTO SALES_INFO  VALUES ('100002','20160004','2000','1','2000','A004','20160102');
INSERT INTO SALES_INFO  VALUES ('100002','20160005','500','1','500','A001','20160103');
INSERT INTO SALES_INFO  VALUES ('100003','20160006','1500','2','3000','A003','20160103');
INSERT INTO SALES_INFO  VALUES ('100004','20160007','500','2','1000','A001','20160104');
INSERT INTO SALES_INFO  VALUES ('100004','20160008', '300','1','300','A005','20160104');
INSERT INTO SALES_INFO  VALUES ('100004', '20160009','600','1','600','A006','20160104');
INSERT INTO SALES_INFO  VALUES ('100004', '20160010','3000','1','3000','A007','20160106');

SELECT * FROM SALES_INFO;


drop table money;
CREATE TABLE money AS
SELECT A.CUSTNO, A.CUSTNAME, A.GRADE, SUM(B.PRICE) AS TOTAL 
FROM customer_info A 
JOIN sales_info B ON A.CUSTNO = B.CUSTNO 
GROUP BY A.CUSTNO, A.CUSTNAME, A.GRADE
ORDER BY TOTAL DESC;

CREATE TABLE money (
    custno NUMBER,
    custname VARCHAR2(255),
    grade VARCHAR2(10),
    total NUMBER
);




CREATE TABLE money AS
SELECT
    a.custno,
    a.custname,
    CASE
        WHEN a.grade = 'A' THEN 'VIP'
        WHEN a.grade = 'B' THEN '일반'
        WHEN a.grade = 'C' THEN '직원'
    END AS grade,
    SUM(b.price) AS total
FROM
    customer_info a
JOIN
    sales_info b
ON
    a.custno = b.custno
GROUP BY
    a.custno,
    a.custname,
    a.grade
ORDER BY
    total DESC;





desc CUSTOMER_INFO;
select * from CUSTOMER_INFO;
commit;